<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>哇哈哈量化系统 Pro</title>
    <link rel="stylesheet" href="static/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>

<div class="app-layout">
    
    <header class="top-bar">
        <div class="brand">🚀 哇哈哈 Pro</div>
        
        <nav class="main-nav">
            <button class="nav-tab active" data-target="view-selection">🎯 选股页签</button>
            <button class="nav-tab" data-target="view-backtest">📊 回测页签</button>
            <button class="nav-tab" data-target="view-holdings">💼 持仓页签</button>
        </nav>

        <div class="global-actions">
            <input type="password" id="tushareToken" placeholder="Tushare Token" class="input-dark">
            <button class="btn btn-success" id="api-update-data">🔄 更新数据</button>
            <button class="btn btn-danger" id="api-stop-backend">⏹ 关闭后台</button>
        </div>
    </header>

    <div class="workspace">

        <div id="view-selection" class="view-container active">
            <aside class="sidebar">
                <div class="panel-header">
                    <span>📝 买入条件配置</span>
                    <div class="mini-tools">
                        <button class="icon-btn" id="api-export-buy-config" title="导出条件配置">💾</button>
                        <button class="icon-btn" id="api-import-buy-config" title="导入条件配置">📥</button>
                    </div>
                </div>
                <div class="config-list" id="buy-factor-container">
                    </div>
                <div class="panel-footer">
                    <button class="btn btn-primary" id="btn-add-buy-factor" onclick="App.showFactorModal('buy')">
                        <i class="fas fa-plus"></i> 添加买入因子组合
                    </button>
                    <!--<button class="btn btn-primary full-width" id="btn-add-buy-factor">+ 添加买入因子</button>-->
                </div>
            </aside>

            <main class="main-content">
                <div class="chart-area">
                    <div class="section-title">📉 行情预览 (选股专用)</div>
                    <canvas id="klineCanvas" width="1000" height="400"></canvas>
                </div>
                <div class="result-area">
                    <div class="table-header">
                        <span>选股结果</span>
                        <button class="btn btn-primary btn-sm" id="api-run-selection">开始选股</button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr><th>代码</th><th>名称</th><th>现价</th><th>综合得分</th><th>操作</th></tr>
                        </thead>
                        <tbody id="selection-result-table"></tbody>
                    </table>
                </div>
            </main>
        </div>

        <div id="view-backtest" class="view-container">
            <aside class="sidebar">
                <div class="panel-header">⚙️ 回测策略源</div>
                <div class="config-form">
                    <div class="form-item">
                        <label>买入策略 (选股导出数据)</label>
                        <select id="backtest-buy-source" class="input-dark">
                            <option value="current">使用当前选股页配置</option>
                        </select>
                        <button class="btn btn-sm btn-outline" id="api-load-buy-file">📂 加载文件</button>
                    </div>
                    <div class="form-item">
                        <label>卖出策略 (持仓导出数据)</label>
                        <select id="backtest-sell-source" class="input-dark">
                            <option value="current">使用当前持仓页配置</option>
                        </select>
                        <button class="btn btn-sm btn-outline" id="api-load-sell-file">📂 加载文件</button>
                    </div>
                </div>
            </aside>

            <main class="main-content">
                <div class="toolbar">
                    <div class="tool-group">
                        <label>时间范围</label>
                        <input type="date" id="bt-start-date" class="input-dark">
                        <span>至</span>
                        <input type="date" id="bt-end-date" class="input-dark">
                    </div>
                    <div class="tool-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="bt-is-ideal"> 是否为理想买入卖出
                        </label>
                    </div>
                    <button class="btn btn-primary" id="api-run-backtest">▶ 开始回测</button>
                </div>

                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="label">最终总盈亏</div>
                        <div class="value highlight" id="res-total-pnl">0.00%</div>
                    </div>
                    <div class="summary-card">
                        <div class="label">胜率</div>
                        <div class="value" id="res-win-rate">0%</div>
                    </div>
                    <div class="summary-card">
                        <div class="label">最大回撤</div>
                        <div class="value down" id="res-max-drawdown">0.00%</div>
                    </div>
                </div>

                <div class="table-area">
                    <div class="section-title">📃 回测交易流水 (买入/卖出/盈亏)</div>
                    <table class="data-table">
                        <thead>
                            <tr><th>日期</th><th>股票</th><th>动作</th><th>价格</th><th>收益</th><th>当前权益</th></tr>
                        </thead>
                        <tbody id="backtest-log-table"></tbody>
                    </table>
                </div>
            </main>
        </div>

        <div id="view-holdings" class="view-container">
            <aside class="sidebar">
                <div class="panel-header">
                    <span>✂️ 卖出策略配置</span>
                    <div class="mini-tools">
                        <button class="icon-btn" id="api-export-sell-config">💾</button>
                        <button class="icon-btn" id="api-import-sell-config">📥</button>
                    </div>
                </div>
                <div class="config-list" id="sell-factor-container">
                    </div>
                <div class="panel-footer">
                    <button class="btn btn-primary" id="btn-add-sell-factor" onclick="App.showFactorModal('sell')">
                        <i class="fas fa-plus"></i> 添加卖出因子组合
                    </button>
                    <!--<button class="btn btn-warning full-width" id="btn-add-sell-factor">+ 添加卖出因子</button>-->
                </div>
            </aside>

            <main class="main-content">
                <div class="holdings-top">
                    <div class="section-title">💼 当前持仓明细</div>
                    <button class="btn btn-danger" id="api-diagnose-holdings">🩺 卖出策略诊断</button>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>代码</th><th>名称</th><th>买入价</th><th>买入日期</th>
                            <th>当前价</th><th>涨幅</th><th>盈利额</th><th>状态</th>
                        </tr>
                    </thead>
                    <tbody id="holdings-table"></tbody>
                </table>

                <div class="diagnosis-panel">
                    <div class="section-title">📈 策略执行结果预演</div>
                    <div id="diagnosis-output" class="diagnosis-content">
                        等待诊断执行...
                    </div>
                </div>
            </main>
        </div>

    </div>

    <footer class="log-panel">
        <div class="log-header">
            <span>控制台日志 (Console)</span>
            <button class="btn-clear" id="btn-clear-log">清空日志</button>
        </div>
        <div class="log-body" id="global-log-container">
            <div class="log-item system">[系统] 界面初始化完成...</div>
        </div>
    </footer>

</div>

<div class="modal-overlay" id="factor-modal">
    <div class="modal-content">
        <h3>选择因子类型</h3>
        <div class="factor-type-grid" id="factor-type-list">
            </div>
        <button class="btn btn-secondary" id="btn-close-modal">取消</button>
    </div>
</div>

<script src="static/app.js"></script>
</body>
</html>